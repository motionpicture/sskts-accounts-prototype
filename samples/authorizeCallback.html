<html>

<head>

    <script>
        parseHash({}, function (err, result) {
            // 親ウィンドウに認可結果を渡す
            console.log('silentCallback result:', result);
            console.log('parent window:', parent.name);
            if (window.opener !== null) {
                window.opener.postMessage(err || result, '*');
            } else {
                window.parent.postMessage(err || result, '*');
            }
        });

        function parseHash(options, cb) {
            var parsedQs = {};
            var hashStr = (options.hash === undefined) ? window.location.hash : options.hash;
            hashStr = hashStr.replace(/^#?\/?/, '');
            console.log('hashStr:', hashStr);
            hashStr.split('&').forEach(function (keyValue) {
                parsedQs[keyValue.split('=')[0]] = keyValue.split('=')[1];
            });
            // parsedQs = qs.parse(hashStr);

            if (parsedQs.hasOwnProperty('error')) {
                var err = {
                    error: parsedQs.error,
                    errorDescription: parsedQs.error_description
                };

                if (parsedQs.state) {
                    err.state = parsedQs.state;
                }

                return cb(err);
            }

            if (
                !parsedQs.hasOwnProperty('access_token') &&
                !parsedQs.hasOwnProperty('id_token') &&
                !parsedQs.hasOwnProperty('refresh_token')
            ) {
                return cb(null, null);
            }

            cb(null, buildParseHashResponse(parsedQs));
        };

        function buildParseHashResponse(qsParams) {
            return {
                accessToken: qsParams.access_token || null,
                idToken: qsParams.id_token || null,
                state: qsParams.state || null,
                expiresIn: qsParams.expires_in ? parseInt(qsParams.expires_in, 10) : null,
                tokenType: qsParams.token_type || null,
                scope: qsParams.scope || null
            };
        }
    </script>
</head>

<body>
</body>

</html>