<html>

<head>

    <script>
        parseHash({}, function (err, result) {
            // 親ウィンドウに認可結果を渡す
            console.log('silentCallback result:', result);
            console.log('parent window:', parent.name);
            if (window.opener !== null) {
                window.opener.postMessage(err || result, '*');
            } else {
                window.parent.postMessage(err || result, '*');
            }
        });

        function parseHash(options, cb) {
            var parsedQs = {};
            var hashStr = (options.hash === undefined) ? window.location.hash : options.hash;
            hashStr = hashStr.replace(/^#?\/?/, '');
            console.log('hashStr:', hashStr);
            hashStr.split('&').forEach(function (keyValue) {
                parsedQs[keyValue.split('=')[0]] = keyValue.split('=')[1];
            });
            // parsedQs = qs.parse(hashStr);

            if (parsedQs.hasOwnProperty('error')) {
                err = error.buildResponse(parsedQs.error, parsedQs.error_description);

                if (parsedQs.state) {
                    err.state = parsedQs.state;
                }

                return cb(err);
            }

            if (
                !parsedQs.hasOwnProperty('access_token') &&
                !parsedQs.hasOwnProperty('id_token') &&
                !parsedQs.hasOwnProperty('refresh_token')
            ) {
                return cb(null, null);
            }

            cb(null, parsedQs);
        };
    </script>
</head>

<body>
</body>

</html>